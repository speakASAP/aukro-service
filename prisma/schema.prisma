generator client {
  provider      = "prisma-client-js"
  output        = "../shared/node_modules/.prisma/client"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

generator client_default {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Aukro Account - stores Aukro platform account credentials
model AukroAccount {
  id          String      @id @default(uuid()) @db.Uuid
  name        String      @db.VarChar(200)
  email       String      @db.VarChar(200)
  apiKey      String?     @db.Text // Encrypted API key if Aukro provides API
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now()) @db.Timestamp(6)
  updatedAt   DateTime    @updatedAt @db.Timestamp(6)
  offers      AukroOffer[]
  orders      AukroOrder[]

  @@index([email])
  @@index([isActive])
  @@map("aukro_accounts")
}

// Aukro Offer - Aukro marketplace offers linked to catalog products
model AukroOffer {
  id              String       @id @default(uuid()) @db.Uuid
  accountId       String       @db.Uuid
  productId       String?      @db.Uuid // Catalog product ID (no FK - references catalog-microservice)
  aukroOfferId    String?      @db.VarChar(100) // Aukro platform offer ID
  title           String       @db.VarChar(500)
  description     String?      @db.Text
  price           Decimal      @db.Decimal(10, 2)
  stockQuantity   Int          @default(0)
  isActive        Boolean      @default(true)
  rawData         Json?        // Original Aukro API response
  createdAt       DateTime     @default(now()) @db.Timestamp(6)
  updatedAt       DateTime     @updatedAt @db.Timestamp(6)
  account         AukroAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([accountId])
  @@index([aukroOfferId])
  @@index([isActive])
  @@map("aukro_offers")
}

// Aukro Order - Orders received from Aukro (temporary storage before forwarding to order-microservice)
model AukroOrder {
  id              String       @id @default(uuid()) @db.Uuid
  accountId       String       @db.Uuid
  aukroOrderId    String       @unique @db.VarChar(100) // Aukro platform order ID
  orderId         String?      @db.Uuid // Order ID from order-microservice (after forwarding)
  customerEmail   String?      @db.VarChar(200)
  customerPhone   String?      @db.VarChar(50)
  total           Decimal      @db.Decimal(10, 2)
  currency        String       @default("CZK") @db.VarChar(3)
  status          String       @default("pending") @db.VarChar(50)
  forwarded       Boolean      @default(false) // Whether order was forwarded to order-microservice
  rawData         Json?        // Original Aukro order data
  createdAt       DateTime     @default(now()) @db.Timestamp(6)
  updatedAt       DateTime     @updatedAt @db.Timestamp(6)
  account         AukroAccount @relation(fields: [accountId], references: [id], onDelete: Cascade)

  @@index([accountId])
  @@index([aukroOrderId])
  @@index([status])
  @@index([forwarded])
  @@map("aukro_orders")
}

